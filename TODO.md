# Kitsumy ‚Äî TODO

## –§–∞–∑–∞ 1 ‚Äî –ë–µ–∑–ø–µ–∫–∞ —Ç–∞ —Å—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å

| # | –ó–∞–≤–¥–∞–Ω–Ω—è | –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å | –°—Ç–∞—Ç—É—Å |
|---|----------|------------|--------|
| 1.1 | –í–∏–¥–∞–ª–∏—Ç–∏ `.env` –∑ git history (`git filter-branch` –∞–±–æ BFG) | –õ–µ–≥–∫–æ | ‚¨ú |
| 1.2 | –î–æ–¥–∞—Ç–∏ `.env` –¥–æ `.gitignore` | –õ–µ–≥–∫–æ | ‚¨ú |
| 1.3 | –î–æ–¥–∞—Ç–∏ error handling –≤ orchestrator (try-catch –¥–ª—è AI –≤–∏–∫–ª–∏–∫—ñ–≤) | –õ–µ–≥–∫–æ | ‚¨ú |
| 1.4 | –î–æ–¥–∞—Ç–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é –∑–∞–ø–∏—Ç—ñ–≤ —á–µ—Ä–µ–∑ Zod | –õ–µ–≥–∫–æ | ‚¨ú |
| 1.5 | –î–æ–¥–∞—Ç–∏ rate limiting (`@fastify/rate-limit`) | –õ–µ–≥–∫–æ | ‚¨ú |

---

## –§–∞–∑–∞ 2 ‚Äî –Ü–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (RunPod Hybrid)

| # | –ó–∞–≤–¥–∞–Ω–Ω—è | –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å | –°—Ç–∞—Ç—É—Å |
|---|----------|------------|--------|
| 2.1 | –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ Redis (–ª–æ–∫–∞–ª—å–Ω–æ –∞–±–æ cloud) | –õ–µ–≥–∫–æ | ‚¨ú |
| 2.2 | –Ü–º–ø–ª–µ–º–µ–Ω—Ç—É–≤–∞—Ç–∏ BullMQ job queue | –°–µ—Ä–µ–¥–Ω—å–æ | ‚¨ú |
| 2.3 | –î–æ–¥–∞—Ç–∏ WebSocket/SSE –¥–ª—è real-time —Å—Ç–∞—Ç—É—Å—É | –°–µ—Ä–µ–¥–Ω—å–æ | ‚¨ú |
| 2.4 | –Ü–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ RunPod Serverless | –°–µ—Ä–µ–¥–Ω—å–æ | ‚¨ú |
| 2.5 | –Ü–º–ø–ª–µ–º–µ–Ω—Ç—É–≤–∞—Ç–∏ RunPod Spot Pod Manager | –°–∫–ª–∞–¥–Ω–æ | ‚¨ú |
| 2.6 | –î–æ–¥–∞—Ç–∏ Preemption Handler (30-—Å–µ–∫ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è) | –°–∫–ª–∞–¥–Ω–æ | ‚¨ú |
| 2.7 | –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π fallback Spot ‚Üí Serverless | –°–µ—Ä–µ–¥–Ω—å–æ | ‚¨ú |
| 2.8 | Auto-shutdown Spot Pod –ø—Ä–∏ idle > 5 —Ö–≤ | –õ–µ–≥–∫–æ | ‚¨ú |
| 2.9 | Cost Tracker ‚Äî –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –≤–∏—Ç—Ä–∞—Ç | –õ–µ–≥–∫–æ | ‚¨ú |

### –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —á–µ—Ä–≥–∏ –∑–∞–≤–¥–∞–Ω—å

```typescript
interface ImageJob {
  id: string;
  comicId: string;
  panelIndex: number;
  prompt: string;
  style: ComicStyle;
  status: 'queued' | 'processing' | 'completed' | 'failed';
  provider: 'spot' | 'serverless';
  attempts: number;
  createdAt: Date;
}

interface SpotPodState {
  status: 'offline' | 'booting' | 'ready' | 'busy' | 'preemption_warning';
  podId: string | null;
  bootedAt: Date | null;
  lastJobAt: Date | null;
  jobsInQueue: number;
}
```

### –í–∏–±—ñ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π)

| –£–º–æ–≤–∞ | Provider | –ü—Ä–∏—á–∏–Ω–∞ |
|-------|----------|---------|
| > 20 –∑–æ–±—Ä–∞–∂–µ–Ω—å | **Spot Pod** | –ï–∫–æ–Ω–æ–º–Ω—ñ—à–µ, –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –æ–∫—É–ø–∞—î—Ç—å—Å—è |
| < 20 –∑–æ–±—Ä–∞–∂–µ–Ω—å | Serverless | –®–≤–∏–¥—à–µ, —Ä—ñ–∑–Ω–∏—Ü—è –≤ —Ü—ñ–Ω—ñ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ |
| Spot Pod offline | Serverless | –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π fallback |
| Preemption | Serverless | –ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Ä–µ—à—Ç—É –∑–æ–±—Ä–∞–∂–µ–Ω—å |
| Urgency flag | Serverless | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–ª–∞—Ç–∏—Ç—å –∑–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å |

---

## –§–∞–∑–∞ 3 ‚Äî Layout Engine

| # | –ó–∞–≤–¥–∞–Ω–Ω—è | –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å | –°—Ç–∞—Ç—É—Å |
|---|----------|------------|--------|
| 3.1 | AI Panel Importance Scoring (1-5) | –°–µ—Ä–µ–¥–Ω—å–æ | ‚¨ú |
| 3.2 | –î–∏–Ω–∞–º—ñ—á–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è grid layout | –°–∫–ª–∞–¥–Ω–æ | ‚¨ú |
| 3.3 | Auto Bubble Placement (—É–Ω–∏–∫–Ω–µ–Ω–Ω—è –æ–±–ª–∏—á) | –°–∫–ª–∞–¥–Ω–æ | ‚¨ú |
| 3.4 | Reading Flow Optimizer (Z-pattern) | –°–µ—Ä–µ–¥–Ω—å–æ | ‚¨ú |
| 3.5 | Panel Transitions (—Ä—ñ–∑–Ω—ñ —Ä–æ–∑–º—ñ—Ä–∏ –¥–ª—è –¥—Ä–∞–º–∞—Ç–∏—á–Ω–æ—Å—Ç—ñ) | –°–µ—Ä–µ–¥–Ω—å–æ | ‚¨ú |

### Panel Importance Scoring

```typescript
interface PanelMetadata {
  importance: 1 | 2 | 3 | 4 | 5;  // AI –≤–∏–∑–Ω–∞—á–∞—î
  type: 'action' | 'dialogue' | 'establishing' | 'transition' | 'climax';
  characters: string[];
  emotion: string;
}

// Importance ‚Üí Panel Size
// 5 (climax)     ‚Üí full-width –∞–±–æ splash
// 4 (action)     ‚Üí large (50% width)
// 3 (dialogue)   ‚Üí medium (33% width)
// 2 (transition) ‚Üí small (25% width)
// 1 (filler)     ‚Üí tiny (–≤—Å—Ç–∞–≤–∫–∞)
```

---

## –§–∞–∑–∞ 4 ‚Äî Editor –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è

| # | –ó–∞–≤–¥–∞–Ω–Ω—è | –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å | –°—Ç–∞—Ç—É—Å |
|---|----------|------------|--------|
| 4.1 | SFX Text –µ–ª–µ–º–µ–Ω—Ç–∏ (BOOM!, CRASH!, —Ç–æ—â–æ) | –õ–µ–≥–∫–æ | ‚¨ú |
| 4.2 | Thought Bubbles (—Ö–º–∞—Ä–∏–Ω–∫–∏ –¥–ª—è –¥—É–º–æ–∫) | –õ–µ–≥–∫–æ | ‚¨ú |
| 4.3 | Speed Lines / Motion Blur | –°–µ—Ä–µ–¥–Ω—å–æ | ‚¨ú |
| 4.4 | Panel Borders –∑ —Ä—ñ–∑–Ω–∏–º–∏ —Å—Ç–∏–ª—è–º–∏ | –õ–µ–≥–∫–æ | ‚¨ú |
| 4.5 | Gutter spacing –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è | –õ–µ–≥–∫–æ | ‚¨ú |
| 4.6 | Export —É —Ä—ñ–∑–Ω—ñ —Ñ–æ—Ä–º–∞—Ç–∏ (PDF, PNG, CBZ) | –°–µ—Ä–µ–¥–Ω—å–æ | ‚¨ú |

---

## –§–∞–∑–∞ 5 ‚Äî –Ø–∫—ñ—Å—Ç—å –∑–æ–±—Ä–∞–∂–µ–Ω—å

| # | –ó–∞–≤–¥–∞–Ω–Ω—è | –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å | –°—Ç–∞—Ç—É—Å |
|---|----------|------------|--------|
| 5.1 | Character Consistency (seed-based generation) | –°–∫–ª–∞–¥–Ω–æ | ‚¨ú |
| 5.2 | –î–æ—Å–ª—ñ–¥–∏—Ç–∏ comic-specific LoRA –º–æ–¥–µ–ª—ñ | –°–µ—Ä–µ–¥–Ω—å–æ | ‚¨ú |
| 5.3 | –ú—É–ª—å—Ç–∏-–º–æ–¥–µ–ª—å–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ (–≤–∏–±—ñ—Ä —Å—Ç–∏–ª—é ‚Üí –º–æ–¥–µ–ª—å) | –°–µ—Ä–µ–¥–Ω—å–æ | ‚¨ú |

---

## –§–∞–∑–∞ 6 ‚Äî –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –ë–î

| # | –ó–∞–≤–¥–∞–Ω–Ω—è | –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å | –°—Ç–∞—Ç—É—Å |
|---|----------|------------|--------|
| 6.1 | Unit —Ç–µ—Å—Ç–∏ –¥–ª—è orchestrator | –°–µ—Ä–µ–¥–Ω—å–æ | ‚¨ú |
| 6.2 | E2E —Ç–µ—Å—Ç–∏ –¥–ª—è API endpoints | –°–µ—Ä–µ–¥–Ω—å–æ | ‚¨ú |
| 6.3 | –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ SQLite/PostgreSQL –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–æ–º—ñ–∫—Å—ñ–≤ | –°–µ—Ä–µ–¥–Ω—å–æ | ‚¨ú |
| 6.4 | –ö–µ—à—É–≤–∞–Ω–Ω—è AI —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ | –õ–µ–≥–∫–æ | ‚¨ú |

---

## –ï–∫–æ–Ω–æ–º—ñ–∫–∞ RunPod (–¥–æ–≤—ñ–¥–∫–∞)

| –ö–æ–º—ñ–∫—Å—ñ–≤/–¥–µ–Ω—å | Replicate | RunPod Spot | –ï–∫–æ–Ω–æ–º—ñ—è/–º—ñ—Å—è—Ü—å |
|---------------|-----------|-------------|-----------------|
| 10 | $300 | $18 | **$282** |
| 50 | $1,500 | $90 | **$1,410** |
| 100 | $3,000 | $180 | **$2,820** |
| 500 | $15,000 | $900 | **$14,100** |

---

## Real-time Events (WebSocket/SSE)

```typescript
type ServerEvent =
  | { type: 'pod_booting'; estimatedTime: number }
  | { type: 'pod_ready' }
  | { type: 'pod_preemption_warning'; timeLeft: number }
  | { type: 'fallback_activated'; reason: string }
  | { type: 'generation_progress'; current: number; total: number }
  | { type: 'generation_complete'; imageUrl: string }
  | { type: 'queue_position'; position: number };
```

## Spot Pod Lifecycle

```
1. BOOT_REQUESTED    ‚Üí "üîÑ –ó–∞–ø—É—Å–∫–∞—î–º–æ —Å–µ—Ä–≤–µ—Ä... (~4 —Ö–≤)"
2. BOOTING           ‚Üí "‚è≥ –°–µ—Ä–≤–µ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è..."
3. READY             ‚Üí "‚úÖ –°–µ—Ä–≤–µ—Ä –≥–æ—Ç–æ–≤–∏–π, –ø–æ—á–∏–Ω–∞—î–º–æ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—é"
4. GENERATING        ‚Üí "üé® –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è 5/40..."
5. PREEMPTION_WARN   ‚Üí "‚ö†Ô∏è –°–µ—Ä–≤–µ—Ä –±—É–¥–µ –∑—É–ø–∏–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ 30 —Å–µ–∫, –ø–µ—Ä–µ–º–∏–∫–∞—î–º–æ—Å—å..."
6. FALLBACK          ‚Üí "üîÄ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∏–π —Å–µ—Ä–≤–µ—Ä"
7. IDLE              ‚Üí "üí§ –°–µ—Ä–≤–µ—Ä –æ—á—ñ–∫—É—î –∑–∞–≤–¥–∞–Ω–Ω—è..."
8. SHUTDOWN          ‚Üí "üõë –°–µ—Ä–≤–µ—Ä –∑—É–ø–∏–Ω–µ–Ω–æ (–µ–∫–æ–Ω–æ–º—ñ—è —Ä–µ—Å—É—Ä—Å—ñ–≤)"
```
