# Kitsumy ‚Äî –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è

## üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏

### 1. –ë–µ–∑–ø–µ–∫–∞ API –∫–ª—é—á—ñ–≤
–§–∞–π–ª `.env` –∑ —Ä–µ–∞–ª—å–Ω–∏–º API –∫–ª—é—á–µ–º –Ω–µ –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó. –î–æ–¥–∞–π –π–æ–≥–æ –¥–æ `.gitignore`:
```
.env
.env.local
```

### 2. –í—ñ–¥—Å—É—Ç–Ω—è –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫
–í `apps/api/src/services/orchestrator.ts` –Ω–µ–º–∞—î try-catch –¥–ª—è AI –≤–∏–∫–ª–∏–∫—ñ–≤ ‚Äî —è–∫—â–æ OpenAI/Replicate –≤–ø–∞–¥–µ, —Å–µ—Ä–≤–µ—Ä –∫—Ä–∞—à–Ω–µ—Ç—å—Å—è.

### 3. –ù–µ–º–∞—î –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó –≤—Ö—ñ–¥–Ω–∏—Ö –¥–∞–Ω–∏—Ö
–í `apps/api/src/index.ts` –∑–∞–ø–∏—Ç–∏ –¥–æ `/generate` –Ω–µ –≤–∞–ª—ñ–¥—É—é—Ç—å—Å—è ‚Äî –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∞ –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å.

---

## üü° –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è

### 4. –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö
–ó–∞—Ä–∞–∑ –≤—Å–µ –≤ –ø–∞–º'—è—Ç—ñ. –î–æ–¥–∞–π:
- **SQLite** (–ø—Ä–æ—Å—Ç—ñ—à–µ) –∞–±–æ **PostgreSQL** –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏—Ö –∫–æ–º—ñ–∫—Å—ñ–≤
- –ö–µ—à—É–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ AI (—Ç–æ–π —Å–∞–º–∏–π prompt = —Ç–æ–π —Å–∞–º–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç)

### 5. –ß–µ—Ä–≥–∞ –∑–∞–≤–¥–∞–Ω—å
BullMQ –≤–∂–µ —î –≤ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—è—Ö, –∞–ª–µ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è. –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –∫–æ–º—ñ–∫—Å—É –∑–∞–π–º–∞—î —á–∞—Å ‚Äî –∫—Ä–∞—â–µ:
```
POST /generate ‚Üí –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ job_id
GET /status/:job_id ‚Üí –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å
```

### 6. Rate limiting
–î–æ–¥–∞–π rate limiter –¥–ª—è API —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –∑–ª–æ–≤–∂–∏–≤–∞–Ω—å:
```bash
npm install @fastify/rate-limit
```

---

## üü¢ –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ –ø–æ—Ä–∞–¥–∏

### 7. Streaming –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π
–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á —á–µ–∫–∞—î –¥–æ–≤–≥–æ –ø–æ–∫–∏ –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è –∫–æ–º—ñ–∫—Å. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π SSE (Server-Sent Events) –¥–ª—è –ø–æ–∫–∞–∑—É –ø—Ä–æ–≥—Ä–µ—Å—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ:
- "–°—Ç–≤–æ—Ä—é—é —Å—é–∂–µ—Ç..."
- "–ü–∏—à—É –¥—ñ–∞–ª–æ–≥–∏..."
- "–ì–µ–Ω–µ—Ä—É—é –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è 1/5..."

### 8. –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂—ñ–≤
–ó–∞—Ä–∞–∑ –∫–æ–∂–Ω–∞ –ø–∞–Ω–µ–ª—å –≥–µ–Ω–µ—Ä—É—î –Ω–æ–≤–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞. –†–æ–∑–≥–ª—è–Ω—å:
- **Seed-based generation** —É Flux
- –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è character descriptions –º—ñ–∂ –ø–∞–Ω–µ–ª—è–º–∏

### 9. –¢–µ—Å—Ç–∏
–ù–µ–º–∞—î –∂–æ–¥–Ω–∏—Ö —Ç–µ—Å—Ç—ñ–≤. –î–æ–¥–∞–π —Ö–æ—á–∞ –±:
- Unit —Ç–µ—Å—Ç–∏ –¥–ª—è orchestrator (mock AI responses)
- E2E —Ç–µ—Å—Ç–∏ –¥–ª—è API endpoints

---

## üé® –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è —è–∫–æ—Å—Ç—ñ –∑–æ–±—Ä–∞–∂–µ–Ω—å

### 10. –°–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ comic-style –º–æ–¥–µ–ª—ñ
–î–æ—Å–ª—ñ–¥–∏—Ç–∏ —Ç–∞ —ñ–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ fine-tuned –º–æ–¥–µ–ª—ñ –¥–ª—è –∫–æ–º—ñ–∫—Å—ñ–≤:
- SDXL –∑ LoRA –¥–ª—è comic book style
- Manga/anime style –º–æ–¥–µ–ª—ñ
- Graphic novel style –º–æ–¥–µ–ª—ñ

### 11. –ú—É–ª—å—Ç–∏-–º–æ–¥–µ–ª—å–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞
–î–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É –≤–∏–±—ñ—Ä —Å—Ç–∏–ª—é:
- **Realistic** ‚Äî Flux 2.0 Pro
- **Comic Book** ‚Äî —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –º–æ–¥–µ–ª—å
- **Manga** ‚Äî anime-style –º–æ–¥–µ–ª—å
- **Graphic Novel** ‚Äî noir/gritty style

### 12. RunPod Hybrid Infrastructure (Spot + Serverless)

–î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ—ó –µ–∫–æ–Ω–æ–º—ñ—ó –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ **–≥—ñ–±—Ä–∏–¥–Ω—É –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É**:

#### –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –≤–∞—Ä—Ç–æ—Å—Ç—ñ (Flux Dev, 40 –∑–æ–±—Ä–∞–∂–µ–Ω—å = 1 –∫–æ–º—ñ–∫—Å):

| –ü—Ä–æ–≤–∞–π–¥–µ—Ä | –¶—ñ–Ω–∞ –∑–∞ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è | –í–∞—Ä—Ç—ñ—Å—Ç—å –∫–æ–º—ñ–∫—Å—É | –ï–∫–æ–Ω–æ–º—ñ—è |
|-----------|-------------------|------------------|----------|
| Replicate | $0.025 | $1.00 | baseline |
| RunPod Serverless | $0.003 | $0.12 | 8x –¥–µ—à–µ–≤—à–µ |
| **RunPod Spot** | **$0.0015** | **$0.06** | **17x –¥–µ—à–µ–≤—à–µ** |

#### –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        USER REQUEST                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ
                               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      JOB QUEUE (BullMQ)                          ‚îÇ
‚îÇ  ‚Ä¢ –ü—Ä–∏–π–º–∞—î –∑–∞–ø–∏—Ç–∏ –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—é                                   ‚îÇ
‚îÇ  ‚Ä¢ –ó–±–µ—Ä—ñ–≥–∞—î –≤ Redis                                              ‚îÇ
‚îÇ  ‚Ä¢ –í–∏–∑–Ω–∞—á–∞—î –æ–ø—Ç–∏–º–∞–ª—å–Ω–∏–π provider                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ                                 ‚îÇ
              ‚ñº                                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   RUNPOD SPOT PODS      ‚îÇ       ‚îÇ  RUNPOD SERVERLESS      ‚îÇ
‚îÇ   (Primary)             ‚îÇ       ‚îÇ  (Fallback)             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚Ä¢ $0.44/hr (A40 GPU)    ‚îÇ       ‚îÇ ‚Ä¢ $0.003/image          ‚îÇ
‚îÇ ‚Ä¢ ~$0.0015/image        ‚îÇ       ‚îÇ ‚Ä¢ Cold start: 5 sec     ‚îÇ
‚îÇ ‚Ä¢ Cold start: 4-5 min   ‚îÇ       ‚îÇ ‚Ä¢ Always available      ‚îÇ
‚îÇ ‚Ä¢ –ú–æ–∂–µ –±—É—Ç–∏ preempted   ‚îÇ       ‚îÇ ‚Ä¢ Auto-scaling          ‚îÇ
‚îÇ ‚Ä¢ –ù–∞–π–¥–µ—à–µ–≤—à–∞ –æ–ø—Ü—ñ—è      ‚îÇ       ‚îÇ                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ                                 ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚îÇ
                               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    WEBSOCKET / SSE                                  ‚îÇ
‚îÇ  Real-time –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—è –∑ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º (—â–æ–± –ø—Ä–∞—Ü—é–≤–∞–ª–æ —ñ –¥–ª—è –º–æ–±—ñ–ª–æ–∫) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### –í–∏–±—ñ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π):

| –£–º–æ–≤–∞ | Provider | –ü—Ä–∏—á–∏–Ω–∞ |
|-------|----------|---------|
| > 20 –∑–æ–±—Ä–∞–∂–µ–Ω—å | **Spot Pod** | –ï–∫–æ–Ω–æ–º–Ω—ñ—à–µ, –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –æ–∫—É–ø–∞—î—Ç—å—Å—è |
| < 20 –∑–æ–±—Ä–∞–∂–µ–Ω—å | Serverless | –®–≤–∏–¥—à–µ, —Ä—ñ–∑–Ω–∏—Ü—è –≤ —Ü—ñ–Ω—ñ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ |
| Spot Pod offline | Serverless | –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π fallback |
| Preemption | Serverless | –ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Ä–µ—à—Ç—É –∑–æ–±—Ä–∞–∂–µ–Ω—å |
| Urgency flag | Serverless | –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –ø–ª–∞—Ç–∏—Ç—å –∑–∞ —à–≤–∏–¥–∫—ñ—Å—Ç—å |

#### Spot Pod Lifecycle:

```
1. BOOT_REQUESTED    ‚Üí "üîÑ –ó–∞–ø—É—Å–∫–∞—î–º–æ —Å–µ—Ä–≤–µ—Ä... (~4 —Ö–≤)"
2. BOOTING           ‚Üí "‚è≥ –°–µ—Ä–≤–µ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è..."
3. READY             ‚Üí "‚úÖ –°–µ—Ä–≤–µ—Ä –≥–æ—Ç–æ–≤–∏–π, –ø–æ—á–∏–Ω–∞—î–º–æ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—é"
4. GENERATING        ‚Üí "üé® –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è 5/40..."
5. PREEMPTION_WARN   ‚Üí "‚ö†Ô∏è –°–µ—Ä–≤–µ—Ä –±—É–¥–µ –∑—É–ø–∏–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ 30 —Å–µ–∫, –ø–µ—Ä–µ–º–∏–∫–∞—î–º–æ—Å—å..."
6. FALLBACK          ‚Üí "üîÄ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∏–π —Å–µ—Ä–≤–µ—Ä"
7. IDLE              ‚Üí "üí§ –°–µ—Ä–≤–µ—Ä –æ—á—ñ–∫—É—î –∑–∞–≤–¥–∞–Ω–Ω—è..."
8. SHUTDOWN          ‚Üí "üõë –°–µ—Ä–≤–µ—Ä –∑—É–ø–∏–Ω–µ–Ω–æ (–µ–∫–æ–Ω–æ–º—ñ—è —Ä–µ—Å—É—Ä—Å—ñ–≤)"
```

#### Job Queue Design:

```typescript
interface ImageJob {
  id: string;
  comicId: string;
  panelIndex: number;
  prompt: string;
  style: ComicStyle;
  status: 'queued' | 'processing' | 'completed' | 'failed';
  provider: 'spot' | 'serverless';
  attempts: number;
  createdAt: Date;
}

interface SpotPodState {
  status: 'offline' | 'booting' | 'ready' | 'busy' | 'preemption_warning';
  podId: string | null;
  bootedAt: Date | null;
  lastJobAt: Date | null;
  jobsInQueue: number;
}
```

#### Real-time Events (WebSocket/SSE):

```typescript
type ServerEvent =
  | { type: 'pod_booting'; estimatedTime: number }
  | { type: 'pod_ready' }
  | { type: 'pod_preemption_warning'; timeLeft: number }
  | { type: 'fallback_activated'; reason: string }
  | { type: 'generation_progress'; current: number; total: number }
  | { type: 'generation_complete'; imageUrl: string }
  | { type: 'queue_position'; position: number };
```

#### –ï–∫–æ–Ω–æ–º—ñ–∫–∞ –ø—Ä–∏ —Ä—ñ–∑–Ω–∏—Ö –æ–±—Å—è–≥–∞—Ö:

| –ö–æ–º—ñ–∫—Å—ñ–≤/–¥–µ–Ω—å | Replicate | RunPod Spot | –ï–∫–æ–Ω–æ–º—ñ—è/–º—ñ—Å—è—Ü—å |
|---------------|-----------|-------------|-----------------|
| 10 | $300 | $18 | **$282** |
| 50 | $1,500 | $90 | **$1,410** |
| 100 | $3,000 | $180 | **$2,820** |
| 500 | $15,000 | $900 | **$14,100** |

#### –Ü–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü—ñ—è (–∫—Ä–æ–∫–∏):

1. **BullMQ + Redis** ‚Äî —á–µ—Ä–≥–∞ –∑–∞–≤–¥–∞–Ω—å
2. **RunPod Pod Manager** ‚Äî –∫–µ—Ä—É–≤–∞–Ω–Ω—è Spot Pods (start/stop/monitor)
3. **Preemption Handler** ‚Äî –æ–±—Ä–æ–±–∫–∞ 30-—Å–µ–∫—É–Ω–¥–Ω–æ–≥–æ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è
4. **Fallback Logic** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—è –Ω–∞ Serverless
5. **WebSocket Server** ‚Äî real-time —Å—Ç–∞—Ç—É—Å –¥–ª—è UI
6. **Cost Tracker** ‚Äî –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –≤–∏—Ç—Ä–∞—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
7. **Auto-shutdown** ‚Äî –≤–∏–º–∏–∫–∞—Ç–∏ Spot Pod —è–∫—â–æ –Ω–µ–º–∞—î –∑–∞–≤–¥–∞–Ω—å > 5 —Ö–≤

---

## üìã –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–Ω–∏–π –ø–ª–∞–Ω –¥—ñ–π

| –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç | –ó–∞–≤–¥–∞–Ω–Ω—è | –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å | –°—Ç–∞—Ç—É—Å |
|-----------|----------|------------|--------|
| 1 | –í–∏–¥–∞–ª–∏—Ç–∏ `.env` –∑ git history | –õ–µ–≥–∫–æ | |
| 2 | –î–æ–¥–∞—Ç–∏ error handling –≤ orchestrator | –õ–µ–≥–∫–æ | |
| 3 | –î–æ–¥–∞—Ç–∏ –≤–∞–ª—ñ–¥–∞—Ü—ñ—é –∑–∞–ø–∏—Ç—ñ–≤ (Zod) | –õ–µ–≥–∫–æ | |
| 4 | **BullMQ + Redis job queue** | –°–µ—Ä–µ–¥–Ω—å–æ | üîú |
| 5 | **WebSocket/SSE real-time —Å—Ç–∞—Ç—É—Å** | –°–µ—Ä–µ–¥–Ω—å–æ | üîú |
| 6 | **RunPod Serverless —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è** | –°–µ—Ä–µ–¥–Ω—å–æ | üîú |
| 7 | **RunPod Spot Pod Manager** | –°–∫–ª–∞–¥–Ω–æ | üîú |
| 8 | **Preemption handling + fallback** | –°–∫–ª–∞–¥–Ω–æ | üîú |
| 9 | –ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ –ë–î –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è | –°–µ—Ä–µ–¥–Ω—å–æ | |
| 10 | –ü–æ–∫—Ä–∞—â–∏—Ç–∏ –ø—Ä–æ–º–ø—Ç–∏ –¥–ª—è comic-style | –õ–µ–≥–∫–æ | ‚úÖ 20 —Å—Ç–∏–ª—ñ–≤ |
| 11 | –ú—É–ª—å—Ç–∏-–º–æ–¥–µ–ª—å–Ω–∏–π –≤–∏–±—ñ—Ä —Å—Ç–∏–ª—é | –°–µ—Ä–µ–¥–Ω—å–æ | ‚úÖ UI –≥–æ—Ç–æ–≤–∏–π |
